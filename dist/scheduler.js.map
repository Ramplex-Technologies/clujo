{"version":3,"sources":["../src/scheduler.ts"],"sourcesContent":["import type Redis from \"ioredis\";\nimport type { IClujo } from \"./clujo.types\";\n\n/**\n * Scheduler class for managing and running Clujo jobs.\n * This class allows adding, starting, and stopping multiple Clujo jobs in a centralized manner.\n */\nexport class Scheduler {\n  // biome-ignore lint/suspicious/noExplicitAny: handle any combination of clujo's\n  private readonly jobs: { job: IClujo<any, any, any>; completionHandler?: (ctx: any) => Promise<void> | void }[] = [];\n\n  /**\n   * Adds a Clujo job to the scheduler.\n   * @param input - Object containing the job and optional completion handler.\n   * @param input.job - The Clujo job to be added.\n   * @param input.completionHandler - Optional function to invoke after the job completes.\n   */\n  public addJob<TDependencies, TContext>(input: {\n    // biome-ignore lint/suspicious/noExplicitAny: I do not want to type this\n    job: IClujo<TDependencies, TContext, any>;\n    completionHandler?: (ctx: Required<TContext>) => Promise<void> | void;\n  }) {\n    this.jobs.push(input);\n  }\n\n  /**\n   * Starts all added jobs in the scheduler.\n   * @param redis - Optional Redis instance to be passed to the jobs. If provided, enables distributed locking.\n   */\n  public start(redis?: Redis) {\n    for (const { job, completionHandler } of this.jobs) {\n      job.start({ redis, completionHandler });\n    }\n  }\n  /**\n   * Stops all running jobs in the scheduler.\n   * @param timeout - The maximum time (in milliseconds) to wait for jobs to stop.\n   * @returns A promise that resolves when all jobs have stopped or the timeout is reached.\n   */\n  public async stop(timeout: number) {\n    await Promise.all(this.jobs.map(({ job }) => job.stop(timeout)));\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAOO,IAAM,YAAN,MAAgB;AAAA,EAAhB;AAEL;AAAA,SAAiB,OAAiG,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQ5G,OAAgC,OAIpC;AACD,SAAK,KAAK,KAAK,KAAK;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMO,MAAM,OAAe;AAC1B,eAAW,EAAE,KAAK,kBAAkB,KAAK,KAAK,MAAM;AAClD,UAAI,MAAM,EAAE,OAAO,kBAAkB,CAAC;AAAA,IACxC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAa,KAAK,SAAiB;AACjC,UAAM,QAAQ,IAAI,KAAK,KAAK,IAAI,CAAC,EAAE,IAAI,MAAM,IAAI,KAAK,OAAO,CAAC,CAAC;AAAA,EACjE;AACF;","names":[]}